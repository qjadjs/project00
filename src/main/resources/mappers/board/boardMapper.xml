<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.board.boardMapper">
   
   <resultMap id="BoardVOResultMap" type="com.globalin.domain.BoardVO">
  <id property="bno" column="bno"/>
  <result property="title" column="title" />
  <result property="content1" column="content1" />
  <result property="content2" column="content2" />
  <result property="content3" column="content3" />
  <result property="content4" column="content4" />
  <result property="writer" column="writer" />
  <result property="regDate" column="regdate" />
  <result property="updateDate" column="updateDate" />
  <result property="replyCnt" column="replycnt" />
  <result property="viewCnt" column="viewcnt" />
  <result property="likeCnt" column="likeCnt" />
  <result property="userId" column="user_id" />
  <result property="dislikeCnt" column="dislikeCnt" />
  <result property="btype" column="btype"/>
  <association property="userVO" resultMap="userVOResultMap"/>
</resultMap>
<resultMap id="userVOResultMap"
      type="com.globalin.domain.UserVO">
      <id property="userId" column="user_id" />
      <result property="userPw" column="user_pw" />
      <result property="userName" column="user_name" />
      <result property="userEmail" column="user_email" />
      <result property="userJoinDate" column="user_join_date" />
      <result property="userLoginDate" column="user_login_date" />
      <result property="userSignature" column="user_signature" />
      <result property="userImg" column="user_img" />
      <result property="userPoint" column="user_point" />
   </resultMap>

<select id="userBoardList" resultType="com.globalin.domain.BoardVO">
SELECT
  *
  FROM tbl_board
  WHERE user_id = #{userId}
  ORDER BY bno DESC, regdate DESC
</select>
	
	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item="type" collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							title like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'C'.toString()">
							content3 like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'W'.toString()">
							writer like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>
	<insert id="create">
		insert into tbl_board (bno, title, content1, content2, content3, content4, writer, user_id, btype)
		values
		(seq_board.nextval,#{title},#{content1},#{content2},#{content3},#{content4},#{writer},#{userId}, #{btype})
	</insert>
	<insert id="insertSelectKey">
		<selectKey keyProperty="bno" order="BEFORE" resultType="int">
			select seq_board.nextval
			from dual
		</selectKey>
		insert into tbl_board(bno, title, content1, content2, content3, content4, writer)
		values(#{bno},#{title},#{content1},#{content2},#{content3},#{content4},#{writer})
	</insert>
	<select id="read"
		resultType="com.globalin.domain.BoardVO">
		select * from tbl_board where bno =
		#{bno}
	</select>
	<update id="update">
		update tbl_board set title = #{title},
		content1= #{content1}, content2=#{content2}, content3=#{content3}, content4=#{content4}, writer=#{writer}, btype=#{btype},
		updateDate = sysdate where bno =
		#{bno}
	</update>
	<delete id="delete"> delete from tbl_board where bno = #{bno}
	</delete>
	<select id="listAll"
		resultType="com.globalin.domain.BoardVO">
		select * from tbl_board
		where bno > 0
	</select>
	<select id="getListWithPaging"
		resultType="com.globalin.domain.BoardVO">
	<![CDATA[
	select bno, title, content1, content2, content3, content4, writer, regdate, updatedate, replycnt, viewcnt, likecnt, user_id,  dislikecnt, btype, selectcnt, select_a, select_b
				from (select /*+INDEX_DESC(tbl_board pk_board) */
				rownum rn, bno, title, content1, content2, content3, content4, writer, regdate, updatedate, replycnt, viewcnt, likecnt, user_id, dislikecnt, btype, selectcnt, select_a, select_b
				from tbl_board
				where 
				]]>
		<include refid="criteria"></include>
	<![CDATA[
	rownum <= #{pageNum}*#{amount})
				where rn > (#{pageNum}-1)*#{amount}
				]]>
	</select>
	<select id="getListWithPagingWithType"
		resultType="com.globalin.domain.BoardVO">
	<![CDATA[
	select bno, title, content1, content2, content3, content4, writer, regdate, updatedate, replycnt, viewcnt, likecnt, user_id,  dislikecnt, btype, selectcnt, select_a, select_b
				from (select /*+INDEX_DESC(tbl_board pk_board) */
				rownum rn, bno, title, content1, content2, content3, content4, writer, regdate, updatedate, replycnt, viewcnt, likecnt, user_id, dislikecnt, btype, selectcnt, select_a, select_b
				from tbl_board
				where btype = #{btype} and
	rownum <= #{pageNum}*#{amount})
				where rn > (#{pageNum}-1)*#{amount}
				]]>
	</select>
	<select id="getTotalCount" resultType="int">
		select count(*) from
		tbl_board where

      <include refid="criteria"></include>

      bno > 0
   </select>

   <select id="bestList1" resultType="com.globalin.domain.BoardVO">
		SELECT a.BNO,
		a.TITLE,
		a.CONTENT,
		a.WRITER,
		a.REGDATE,
		a.HIT,
		a.REPLYHIT,
		a.BGNO,
		a.LIKEHIT,
		a.HATEHIT,
		a.ID,
		a.DEVHIT,
		a.QUESTIONCHECK,
		a.HELPPOINT,
		b.BNO,
		b.MEMBER_ID,
		c.MEMBER_ID,
		c.MEMBER_DEVPOINT,
		c.MEMBER_POINT,
		c.MEMBER_IMG,
		c.MEMBER_NAME
		FROM (select * from MP_BOARD where REGDATE >= TO_CHAR(SYSDATE-2,'YYYYMMDD' ))
		a left outer JOIN MP_BOARD_CHECK b on a.bno = b.bno 
		<if test=" memberId !='' ">
		AND b.member_id=#{memberId}
		</if>
		left outer Join MP_MEMBER c on a.ID = c.member_ID
		where bgno = 1
		ORDER BY a.LIKECNT desc
		
	</select>
   <update id="updateReplyCnt">
      update tbl_board set replyCnt = replyCnt + #{amount}
      where bno = #{bno}
   </update>
   <update id="updateViewCnt" parameterType="int">
      update tbl_board set
      viewCnt = viewCnt + 1 where bno = #{bno}
   </update>
</mapper>
